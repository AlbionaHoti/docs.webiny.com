---
id: overview-vpc
title: Custom VPC
sidebar_label: Custom VPC
keywords: ["cloud", "infrastructure", "api", "vpc", "lambda", "database", "s3", "storage", "diagram"]
description: Learn about the necessary cloud infrastructure resources on which the API project application relies on.
---

import Theme from "../../../mdxComponents/theme";
import { Box, Button, Grid, Link } from "theme-ui";

:::tip What youâ€™ll learn

- what does the **API** project application represent
- the necessary cloud infrastructure resources on which the **API** project application relies on
:::

## Diagram

<!-- vale off -->

<img
  src={require("./images/webiny_api_overview_vpc.png").default}
  className="no-shadow"
  style={{ marginBottom: 20 }}
  alt="Nice image"
/>

<!-- vale on -->

## Description

During the creation of a new Webiny project, one of the questions that shows up is should your new project be deployed in a Virtual Private Cloud (VPC) or not. The answer to that question depends on your needs, but usually for production environments, having resources deployed in a custom VPC is a reasonable choice.

Note that the VPC setup presented here is a good foundation, but is not an ultimate solution. There is a chance that the setup might need additional cloud infrastructure resources or different configurations on your or your organisation's behalf.

:::info
Even if you choose the non-VPC option at the moment of project creation, your project is still deployed into your AWS account's default VPC. Read more about it in the official [Default VPC and default subnets](https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html) article.
:::

:::info
Virtual Private Clouds (VPCs) is a topic that requires some general networking knowledge and knowledge on AWS-specific concepts like regions, availability zones, different network gateways, and so on. Be sure to [read about it](https://aws.amazon.com/vpc/) before going through this section.
:::

### Key Differences

The shown diagram gives an overview of which cloud infrastructure resources are deployed when the VPC option was chosen during the creation of a new Webiny project. Essentially, resources still work and communicate with each other in the same way, except this time, there are a couple of additional network-level resources, and rules in place. This helps in improving your project's overall security posture.

#### Public and private subnets
The most prominent change, when compared to the default-VPC option, is the inclusion of a VPC that consists of three subnets - one public <diagram-letter>C</diagram-letter> and two private <diagram-letter>D</diagram-letter> <diagram-letter>e</diagram-letter>, deployed across multiple availability zones (AZs).

With this network structure, you are given the opportunity to place mission-critical cloud infrastructure resources into the private subnets <diagram-letter>D</diagram-letter> <diagram-letter>E</diagram-letter>, which makes these resources more secure, because they are not directly exposed to the public internet. This is especially important when talking about hosting databases, for example the Amazon ElasticSearch Service <diagram-letter>H</diagram-letter>.

#### External internet-facing cloud infrastructure resources
The only way resources located in the private subnets <diagram-letter>D</diagram-letter> <diagram-letter>e</diagram-letter> can talk to the public internet is via the public subnet <diagram-letter>C</diagram-letter>, which includes a NAT gateway <diagram-letter>F</diagram-letter>. The NAT (network address translation) gateway is the middleman that forwards all internet-routable network traffic, received from private subnets, to the Internet Gateway <diagram-letter>g</diagram-letter>.

This makes it possible for Lambda functions that are located in private subnets <diagram-letter>D</diagram-letter> <diagram-letter>E</diagram-letter> to talk to resources that operate in an internet facing environment, like Amazon DynamoDB <diagram-letter>i</diagram-letter>, Amazon S3 <diagram-letter>j</diagram-letter>, and Amazon Cognito <diagram-letter>k</diagram-letter>.

:::caution
Note that when private subnet resources are communicating with the ones operating in an internet facing environment <diagram-letter>i</diagram-letter> <diagram-letter>j</diagram-letter> <diagram-letter>k</diagram-letter>, sending and receiving data is still performed across the public internet <diagram-letter>l</diagram-letter>.

If this presents a problem, you may want to integrate a different solution, like for example VPC endpoints for DynamoDB. Check out the [Using Amazon VPC Endpoints to Access DynamoDB](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/vpc-endpoints-dynamodb.html) article to learn more.
:::

#### Multiple Availability Zones

As mentioned, the public and private subnets are deployed across multiple availability zones (AZs). This helps in making your application more highly available, fault tolerant and scalable. For example, if in a single region, one of the AZs goes offline, all of the network traffic is essentially routed to other AZs that are online. This means your application still works.

:::danger Additional cost
Hosting your application in multiple availability zones may incur additional cost, since some of the cloud infrastructure resources get deployed multiple times. For example, this is true for Amazon ElasticSearch Service <diagram-letter>h</diagram-letter>. In contrast, this is not true for Lambda functions deployed into multiple AZs.
:::

Note that the number of distinct AZs depends on the region you're deploying to as some only have 2 AZs. And, since the public subnet is deployed into the default AZ, the number of distinct AZs also depends on which default AZ was picked for you. This is picked by AWS, upon deploying your project application for the first time into the defined environment.

## FAQ

**Is it allowed to make changes to the custom-VPC cloud infrastructure code?**

Yes. The provided [cloud infrastructure code](https://github.com/webiny/webiny-js/tree/v5/packages/cwp-template-aws/template/api/pulumi_vpc) does provide a good foundation, but there might be cases where you'd want to make further adjustments.

**Is it possible to switch from the default-VPC to the custom-VPC setup?**

Yes, you'd just need to alter the cloud infrastructure code accordingly, and redeploy. This can probably be considered as a bigger change to your cloud infrastructure, so make sure to test the deployment before applying changes in your production environment. The [`--preview` flag](/docs/how-to-guides/deployment/preview-deployments) can also come in handy when doing this.

**Is it possible to deploy the custom-VPC setup into the production environment only?**

This can be done. Since the cloud infrastructure is defined using code, nothing prevents you from using a couple of `if` statements to determine which resources need to be deployed.

**Is Amazon ElasticSearch Service <diagram-letter>h</diagram-letter> deployed into multiple AZs?**

Currently it is deployed into a single AZ, just for cost reasons. But yes, production workloads should use two or three AZs. Check out the [Amazon ElasticSearch Service's FAQ page](https://aws.amazon.com/elasticsearch-service/faqs/) for more information.

**How is API Gateway <diagram-letter>B</diagram-letter> communicating with Lambda functions if it's outside of the VPC?**

To our knowledge, there is no official evidence on how this actually works. But, since no additional configuration was needed in order to establish the API Gateway <diagram-letter>B</diagram-letter> - Lambda Functions connection, it means that this is automatically handled for you by AWS's internal structure and mechanisms. This [Stack Overflow](https://stackoverflow.com/questions/60678826/aws-route-from-public-api-gateway-to-in-vpc-lambda) question briefly discusses this, but again, no concrete evidence and answers are provided.
