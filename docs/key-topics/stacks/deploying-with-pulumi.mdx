---
id: deploying-with-pulumi
title: Deploying project stacks with Pulumi
sidebar_label: Deploying with Pulumi
keywords: ["webiny", "stacks", "deployment", "pulumi", "iac"]
description: Infrastructure as Code with Pulumi
---

import Theme from "../../mdxComponents/theme";
import { Box, Button, Grid, Link } from "theme-ui";

ðŸ§¶

---

## Why Pulumi?

For defining and deploying necessary cloud infrastructure for a project stack, by default, Webiny relies on [Pulumi](https://www.pulumi.com/), a modern [infrastructure as code (IaC)](https://docs.aws.amazon.com/whitepapers/latest/introduction-devops-aws/infrastructure-as-code.html) solution.

Webiny chose Pulumi as its default IaC solution for a couple of reasons:

- cloud infrastructure is defined via code (TypeScript)
- it supports multiple cloud providers (AWS, Azure, Google Cloud Platform, ...)
- it provides multiple solutions for storing infrastructure state
- a vibrant and rising community

:::info
Note that Pulumi is the _default_ solution Webiny relies on, which means it doesn't have to be the only one. If you have a need to bring your own IaC solution (like CloudFormation or Terraform), you certainly can. Feel free to [message us](https://www.webiny.com/slack) if that's the case, we'd be glad to assist.
:::

## A closer look

In the following folder structure, we are looking at three project stacks that are set up by default in a new Webiny project. These are the API (`./api`), Admin Area (`./apps/admin`), and Public Website (`./apps/site`) project stacks, which are shown in the following directory structure:

```
.
â”œâ”€â”€ api
â”‚Â Â  â”œâ”€â”€ pulumi
â”‚Â Â  â”œâ”€â”€ Pulumi.yaml
â”‚Â Â  â”œâ”€â”€ Pulumi.dev.yaml
â”‚Â Â  â””â”€â”€ index.ts
â”œâ”€â”€ apps
â”‚Â Â  â”œâ”€â”€ admin
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ pulumi
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Pulumi.yaml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ Pulumi.dev.yaml
â”‚Â Â  â”‚Â Â  â””â”€â”€ index.ts
â”‚Â Â  â””â”€â”€ site
â”‚Â Â   Â Â  â”œâ”€â”€ pulumi
â”‚Â Â   Â Â  â”œâ”€â”€ Pulumi.dev.yaml
â”‚Â Â   Â Â  â”œâ”€â”€ Pulumi.yaml
â”‚Â Â   Â Â  â””â”€â”€ index.ts
â”‚Â Â 
â””â”€â”€ (...)
```

Let's examine how these stacks are utilizing Pulumi in order to define and deploy needed cloud infrastructure resources.

Each of these stacks is a separate [Pulumi project](https://www.pulumi.com/docs/intro/concepts/project/#projects), which essentially means two things:
- every stack contains its own infrastructure-related code, configuration, and state files
- every stack is deployed as a standalone unit (you cannot deploy two stacks in a single operation)

Additionally, it's important to know that every Pulumi program can have one or more **Pulumi program stacks**. These are not to be confused with Webiny project stacks.

From the [official docs](asd):

> Every Pulumi program is deployed to a **stack**. A stack is an isolated, independently configurable instance of a Pulumi program. Stacks are commonly used to denote different phases of development (such as **development**, **staging** and **production**) or feature branches (such as **feature-x-dev**, **jane-feature-x-dev**).

So, from a Webiny project stack's perspective, every project stack is backed by a Pulumi program. A Pulumi program can consist of one or more Pulumi program stacks, which essentially enable you to deploy multiple sets of cloud infrastructure resources. These sets can be exact copies, but can also be different. Respectively, this makes it possible to form a notion of multiple environments, or deploy different infrastructure if a new feature demands it.

In the following section, we briefly cover the key files that form a Pulumi project. Note that if you want to dive deeper, you're certainly encouraged to visit the [official documentation](https://www.pulumi.com/docs/intro/concepts/) which explains these concepts in more detail.

## Pulumi Project Files

#### `Pulumi.yaml`
The `Pulumi.yaml` project file specifies metadata about the Pulumi project. It might look something like the following:
```
name: API
runtime: nodejs
description: The cloud infrastructure necessary for hosting your GraphQL API.
backend:
  url: file://
```

One of the more important properties in this file is the `backend` property, which we cover in the following section.

#### `Pulumi.{stack-name}.yaml`
The `Pulumi.{stack-name}.yaml` file is a [Pulumi stack settings](https://www.pulumi.com/docs/intro/concepts/project/#stack-settings-file) file. There can be more than one stack settings files, for example, for a couple of different environments. For example, it's possible to have `Pulumi.dev.yaml`, `Pulumi.staging.yaml`, `Pulumi.production.yaml`, and so on.

#### `index.ts`
This is the entrypoint file in which you start to define your infrastructure. You can organize the code in any way you like. For example, in the default API, Admin Area, and Public Website stacks, the `index.ts` file just imports different classes, which encapsulate different cloud infrastructure sections. The actual code is abstracted into several files, found in the separate `pulumi` folder.

## State Files
Except the files we mentioned in the previous section, there is also one other type of files the Pulumi produces. These are Pulumi program stack's state files.

These files describe at what state your cloud infrastructure is currently at. For example, it contains a list of all deployed resources, various meta data, configuration, and so on. State files are stored per Pulumi program stack, and by default, they are stored in your project stack, inside the `.pulumi` folder.

## Different Backends
As mentioned, by default, Pulumi state files are stored in your project stack, inside the `.pulumi` folder. While in some cases, storing them locally may work for you, in others, you may want to store these in a controlled, centralized, remote storage.

This is where the concept of Pulumi backends comes into play, which represent different storage services, that you can use for storing your state files.

For example, you can create a simple S3 bucket, and choose to store your files in it. You can also use the Pulumi Service, which, in addition to storing state files, also provides a couple of other cool features.

Read more about different backends in the following [official documentation article](https://www.pulumi.com/docs/intro/concepts/state/).

## FAQ

**Are you using Pulumi's Automation API?**

Currently, Webiny is not using the [Automation API](https://www.pulumi.com/blog/automation-api-workflow/). It's actually using its own [Pulumi SDK](https://github.com/webiny/webiny-js/tree/v5/packages/pulumi-sdk) package, which is just a tiny wrapper over Pulumi CLI. Essentially, it enables programmatic use of the Pulumi CLI, which is similar to what the Automation API is also doing.

**Is it possible to use a different infrastructure-as-code solution?**

Yes, you can certainly use a different solution (for example [CloudFormation](https://aws.amazon.com/cloudformation/) or [Terraform](https://www.terraform.io/)). Feel free to [message us](https://www.webiny.com/slack) if you have this type of a need. We'd be glad to assist in that regard.

**Is it possible to read stack output from another stack?**

It's possible to read output from another stack. This is definitely useful if one or more of your current stack's infrastructure resources are depending on one or more resources from another stack. To learn more, check out the [Reading stack output](#) article.
